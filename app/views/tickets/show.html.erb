<div class="mt100"></div>

    <h1>Purchase tickets for <%#= @event.title %></h1> 
    <p><%#= @event.date.strftime('%A, %B %d, %Y') %>, <%#= number_to_currency @event.price*0.01 %> per ticket. </p>
    <div class="mt30"></div>
      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <%= simple_form_for(@ticket, remote: true) do |f| %>
            <%= f.error_notification %>
            <div class="form-inputs">
              <%= f.input :quantity, label: "Number of tickets" %>
            </div>
            <div class="form-actions">
              <%= f.button :submit, "Calculate payment", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
          <div class="col-md-2 col-md-offset-2 col-sm-6">
            <h3><%= @ticket.quantity %> tickets: </h3><p><%= number_to_currency @ticket.amount*0.01 %></p>
            <div class="mt30"></div>     

    <%= form_tag charges_path, id: 'chargeForm' do %> 
      <!--<article>
        <%#= if flash[:error].present? %>
          <div id="error_explanation">
            <p><%#= flash[:error] %></p>
          </div>
        <%# end %>
      </article>-->
          
      <script src="https://checkout.stripe.com/checkout.js"></script>
        <%= hidden_field_tag 'stripeToken' %>
        <%= hidden_field_tag 'stripeEmail' %>
          <button id="btn-buy" type="button" class="btn btn-success btn-lg">
            Make Purchase
          </button>
      <script>    
        var handler = StripeCheckout.configure({
      key: '<%= Rails.configuration.stripe[:publishable_key] %>',
      token: function(token, arg) {
        document.getElementById("stripeToken").value = token.id;
        document.getElementById("stripeEmail").value = token.email;
        document.getElementById("chargeForm").submit();
      }
    });
     document.getElementById('btn-buy').addEventListener('click', function(e) {
      handler.open({
        name: 'One Month',
        description: 'Growth Hacking Crash Course ($4.99)',
        amount: 499
    });
    e.preventDefault();
   })
  </script>
<% end %>
 
    </div>
  </div>


<div class="mt100"></div>
